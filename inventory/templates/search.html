{% extends 'base.html' %}

{% block title %}
{{ title }}
{% endblock %}

{% block extra_css %}
    <style>
        .table-container {
            padding: 1%;
            margin: 3%;
            margin: 1% 3% 3% 3%;
            font-size: 14px;
        }

        .table-container thead {
            font-weight: bold;
        }

        .table-container a {
            cursor: pointer;
        }

        .ignore-css{all:unset;}

        .select-style {
            width: 100%;
            padding: 2%;
            background-color: #f1f1f1;
        }

        input::placeholder {
            color: grey;
            opacity: 1;
        }
    </style>
{% endblock %}

{% block content %}

<div style="margin-top: 3%;">
    <div class="w3-center">
        <div class="container input-field w3-row">
            <form action="search" method="post">
                {% csrf_token %}
                <div class="w3-col s10">
                    <input type="text" name="search_request" placeholder="Search (Brand/Model/Serial Number/Location/Manufactured Date:'YYYY/MM/DD')" id="search" style="width:100%;" required> 
                </div>
                <div class="w3-col s2" style="padding:15px;">
                    <button type="submit" class="waves-effect waves-light btn w3-indigo"> Search </button>
                </div>
            </form>
        </div>
        {% if search %}
        <div class="w3-card-2 w3-center w3-white table-container" style="margin-left: 2%;">
            <table class="w3-striped highlight w3-centered responsive-table w3-bordered w3-border">
                <thead>
                    <tr class="w3-sand">
                        <td> S.N </td> 
                        <td> Brand </td>
                        <td> Model </td>
                        <td> Serial No. </td>
                        <td> Status </td>
                        <td> Location </td>
                        <td> Manufactured Date </td>
                        <td> Remarks </td>
                        <td> Action </td>
                    </tr>
                </thead>
                <tbody>
                    {% for device in devices %}
                    <tr>
                        <td> {{ forloop.counter }} </td>
                        <td> {{ device.brand }} </td>
                        <td> {{ device.model }} </td>
                        <td> {{ device.serial_number }} </td>
                        <td> {{ device.get_status_display }} </td>
                        <td> {{ device.location }} </td>
                        <td> {{ device.manufactured_date }} </td>
                        {% comment %} <td> {{ device.remarks|truncatechars:20}} </td> {% endcomment %}
                        <td> {{ device.remarks }} </td>
                        <td> 
                            <a class="delete" data-id-brand="{{ device.brand }}" data-id-sn="{{ device.serial_number }}" data-id-model="{{ device.model }}" style="color:red;"> 
                                <span class="fas fa-trash-alt" style="margin-right: 8px;"></span> 
                            </a> 
                            <a style="color:black;" href="{% url 'management:edit-device' pk=device.pk %}"> 
                                <span class="fa fa-pencil-square-o"></span> 
                            </a> 
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}  
            <div class="w3-card-2 w3-center w3-white" style="margin-right:25%; margin-left:25%; padding:5%;">      
                {{ msg }}
            </div>
        {% endif %}
    </div>
</div>

{% endblock %}

{% block buttons %}
<a class="waves-effect waves-light btn w3-indigo" href="/dashboard/" style="margin-right: 5px; margin-bottom:10px;"> <span class="fa fa-arrow-left"></span> Back </a>
{% endblock %}

{% block extra_js %}

<script>
    $(document).ready(function(){
        $('.delete').click(function(event){
            event.preventDefault()

            var csrftoken = $('input[name=csrfmiddlewaretoken').val()
            var brand = $(this).attr('data-id-brand')
            var serial_number = $(this).attr('data-id-sn')
            var model = $(this).attr('data-id-model')

            var info = {
                'brand':brand,
                'serial_number':serial_number,
                'model':model
            }
            
            var alert_message = "Are You Sure You Want To Delete '" + brand + " " + model + " " + serial_number + "' ?"
            swal({
                icon: "warning",
                title: alert_message,
                text:'This action cannot be undone!',
                buttons: true,
                dangerMode: true,
            }).then((value) => {
                if (value) {
                    $.ajax({
                        method:'POST',
                        url:'/delete-device/',
                        headers:{'X-CSRFToken':csrftoken},
                        data:info,
                        success:function(data){
                            swal({
                                icon:data.icon,
                                text:data.msg
                            }).then((data) => {
                                refresh()
                            })
                        }
                    })
                }
            })
        })
    })
</script>

{% endblock %}